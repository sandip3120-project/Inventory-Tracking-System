{% extends "base.html" %}

{% block extra_css %}
<style>
  /* Grid panel for filters */
  .filter-panel {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  @media (min-width: 640px) {
    .filter-panel {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* Common button styles */
  .btn {
    display: inline-block;
    padding: .75rem 1.5rem;
    border-radius: .5rem;
    font-weight: 600;
    text-align: center;
    cursor: pointer;
    transition: background-color .2s, box-shadow .2s;
  }
  .btn-primary {
    background-color: #2563EB;
    color: #FFFFFF !important;
    box-shadow: 0 2px 6px rgba(37,99,235,.4);
    border: none;
  }
  .btn-primary:hover {
    background-color: #1E40AF;
    box-shadow: 0 2px 8px rgba(30,64,175,.5);
  }
  .btn-secondary {
    background-color: #10B981;
    color: #FFFFFF !important;
    box-shadow: 0 2px 6px rgba(16,185,129,.4);
    border: none;
  }
  .btn-secondary:hover {
    background-color: #047857;
    box-shadow: 0 2px 8px rgba(4,120,87,.5);
  }

  /* Search input with icon */
  .search-wrapper {
    position: relative;
  }
  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.25rem;
    color: #6B7280;
  }
  .search-field {
    width: 100%;
    height: 3rem;
    padding: 0 1rem 0 3rem;
    border: 1px solid #D1D5DB;
    border-radius: .5rem;
    font-size: 1rem;
    transition: border-color .2s, box-shadow .2s;
  }
  .search-field:focus {
    outline: none;
    border-color: #3B82F6;
    box-shadow: 0 0 0 3px rgba(59,130,246,.3);
  }

  /* Actions area */
  .actions {
    grid-column: span 4;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto py-8">

  <!-- Title -->
  <h2 class="text-3xl font-bold text-gray-800 mb-6">Find &amp; Print Rolls</h2>

  <!-- Filter Form -->
  <form method="get" action="{% url 'material-print-search' %}"
      class="bg-white p-6 rounded-xl shadow-lg filter-panel mb-8">

    <!-- Date From -->
    <div>
      <label for="date_from">Date From</label>
      <input type="date" id="date_from"   name="date_from"
           value="{{ date_from }}"
           class="w-full h-12 px-4 border rounded-lg" />
    </div>

    <!-- Date To -->
    <div>
      <label for="date_to">Date To</label>
      <input type="date" id="date_to"     name="date_to"
           value="{{ date_to }}"
           class="w-full h-12 px-4 border rounded-lg" />
    </div>

    <!-- Search -->
    <div class="sm:col-span-2">
      <label for="q">Search</label>
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input type="search" id="q" name="q"
             placeholder="Search here‚Ä¶"
             value="{{ q }}"
             class="search-field" />
      </div>
    </div>

    <!-- Department picker only for admins -->
    {% if departments %}
      <div>
        <label for="id_dept">Department</label>
        <select name="dept" id="id_dept" class="form-control">
          <option value="">‚Äî All departments ‚Äî</option>
          {% for d in departments %}
            <option value="{{ d.code }}"
              {% if d.code == selected_dept %}selected{% endif %}>
              {{ d.code }}¬†‚Äì¬†{{ d.name }}
            </option>
          {% endfor %}
        </select>
      </div>
    {% endif %}

    <!-- Action buttons -->
    <div class="actions">
      <button type="submit" class="btn btn-primary">Apply Filters</button>
      <a href="{% url 'material-entry' %}" class="btn btn-secondary">New Entry</a>
    </div>
  </form>


  <!-- Results Table -->
  {% if rolls %}
  <div class="overflow-x-auto bg-white rounded-lg shadow-sm">
    <table class="min-w-full">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3 text-right text-sm font-medium text-gray-600">Mat #</th>
          <th class="px-4 py-3 text-left  text-sm font-medium text-gray-600">Description</th>
          <th class="px-4 py-3 text-left  text-sm font-medium text-gray-600">Batch #</th>
          <th class="px-4 py-3 text-left  text-sm font-medium text-gray-600">Posting¬†Date</th>
          <th class="px-4 py-3 text-left  text-sm font-medium text-gray-600">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for roll in rolls %}
        <tr class="border-t hover:bg-gray-50">
          <td class="px-4 py-3 text-right text-sm text-gray-700">
            {{ roll.batch.material.material_number }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-700">
            {{ roll.batch.material.description }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-700">
            {{ roll.batch.batch_number }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-700">
            {{ roll.batch.created_at|date:"d-m-Y" }}
          </td>
          <td class="px-4 py-3 text-sm">
            <a href="{% url 'material-print' roll.roll_id %}"
               class="text-blue-600 hover:underline font-medium">
              Print ‚èµ
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if is_paginated %}
  <nav class="mt-6 flex justify-center items-center space-x-3">
    {% comment %} build a base querystring without any existing ‚Äúpage‚Äù param {% endcomment %}
    {% with request.GET.items as all_params %}
      {% comment %} Previous {% endcomment %}
      {% if page_obj.has_previous %}
        <a
          href="?{% for key,value in all_params %}
                   {% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}
                 {% endfor %}page={{ page_obj.previous_page_number }}"
          class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition"
        >
          ‚Üê Prev
        </a>
      {% endif %}
  
      <span class="px-3 py-1 text-sm text-gray-700">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </span>
  
      {% comment %} Next {% endcomment %}
      {% if page_obj.has_next %}
        <a
          href="?{% for key,value in all_params %}
                   {% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}
                 {% endfor %}page={{ page_obj.next_page_number }}"
          class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition"
        >
          Next ‚Üí
        </a>
      {% endif %}
    {% endwith %}
  </nav>
  {% endif %}

  {% else %}
    <p class="text-gray-600 mt-4">
      {% if search_query or date_from or date_to %}
        No rolls match your criteria.
      {% else %}
        Enter a term or select dates above to find rolls.
      {% endif %}
    </p>
  {% endif %}

</div>
{% endblock %}
